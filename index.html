<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ClinicBridge – Decode Medical Jargon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ClinicBridge turns medical jargon from audio, text, and prescriptions into simple, clear bullet points for patients and families." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 60%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.18), transparent 60%),
        #020617;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(148,163,184,0.4); border-radius: 999px; }
  </style>
</head>
<body class="min-h-screen text-slate-50 flex justify-center px-4 py-6">
  <div class="w-full max-w-6xl space-y-6">
    <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="h-11 w-11 rounded-2xl bg-gradient-to-tr from-sky-400 via-emerald-400 to-indigo-700 flex items-center justify-center shadow-[0_0_30px_rgba(56,189,248,0.6)]">
          <span class="font-semibold text-lg tracking-tight text-slate-950">CB</span>
        </div>
        <div class="flex flex-col">
          <span class="text-sm font-semibold tracking-wide uppercase text-slate-100">ClinicBridge</span>
          <span class="text-xs text-slate-400">From doctor-speak to human-speak, in minutes.</span>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <div class="inline-flex items-center gap-2 rounded-full border border-slate-700/80 bg-slate-900/80 px-3 py-1 text-[11px] uppercase tracking-[0.18em] text-slate-300">
          <span class="inline-flex h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.9)]"></span>
          <span>Prototype for patients & caregivers</span>
        </div>
        <div class="rounded-full border border-sky-500/60 bg-sky-500/10 px-3 py-1 text-[11px] text-sky-200">
          Built for Maximally Vibe-a-thon
        </div>
      </div>
    </header>

    <main class="grid gap-6 md:grid-cols-[1.1fr_minmax(0,1fr)]">
      <section class="rounded-3xl border border-slate-800/80 bg-slate-900/80 px-5 py-5 shadow-[0_22px_60px_rgba(15,23,42,0.9)] backdrop-blur">
        <div class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-900/80 px-3 py-1 text-[11px] uppercase tracking-[0.18em] text-slate-300 mb-3">
          <span class="h-1.5 w-6 rounded-full bg-gradient-to-r from-sky-400 to-emerald-400"></span>
          <span>Problem</span>
        </div>
        <h1 class="text-2xl md:text-3xl font-semibold leading-tight mb-2">
          Doctors speak in medical jargon.
          <span class="bg-gradient-to-r from-sky-400 to-emerald-400 bg-clip-text text-transparent">Patients deserve clarity.</span>
        </h1>
        <p class="text-sm md:text-[13px] text-slate-300 max-w-xl mb-4">
          ClinicBridge listens to your consultation, prescription, or discharge note and turns it into clear bullet points:
          what is happening, what the doctor plans to do, and what you actually need to remember.
        </p>

        <div class="grid gap-3 md:grid-cols-3 mb-5">
          <div class="rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-3 text-xs flex flex-col gap-1">
            <div class="flex items-center gap-2">
              <span class="h-5 w-5 rounded-full bg-sky-500/20 flex items-center justify-center text-[11px]">1</span>
              <span class="font-semibold text-slate-100">Capture</span>
            </div>
            <p class="text-slate-400 text-[11px]">Record doctor speech, paste text, or scan a prescription.</p>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-3 text-xs flex flex-col gap-1">
            <div class="flex items-center gap-2">
              <span class="h-5 w-5 rounded-full bg-sky-500/20 flex items-center justify-center text-[11px]">2</span>
              <span class="font-semibold text-slate-100">Decode</span>
            </div>
            <p class="text-slate-400 text-[11px]">Identify jargon, treatments, and follow-up steps.</p>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-3 text-xs flex flex-col gap-1">
            <div class="flex items-center gap-2">
              <span class="h-5 w-5 rounded-full bg-sky-500/20 flex items-center justify-center text-[11px]">3</span>
              <span class="font-semibold text-slate-100">Explain</span>
            </div>
            <p class="text-slate-400 text-[11px]">Show 3–6 simple action points the patient can remember.</p>
          </div>
        </div>

        <div class="rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-3 text-[11px] text-slate-300 flex flex-col gap-1">
          <div class="flex items-center gap-2">
            <span class="h-1.5 w-1.5 rounded-full bg-amber-400"></span>
            <span class="uppercase tracking-[0.18em] text-amber-200/90">Important</span>
          </div>
          <p class="text-slate-300/90">
            ClinicBridge is an explanation layer, not a doctor. It helps you understand what was said, but it does not diagnose, treat, or override medical advice.
          </p>
        </div>
      </section>

      <section class="rounded-3xl border border-slate-800/80 bg-slate-950/80 shadow-[0_22px_60px_rgba(15,23,42,0.95)] backdrop-blur px-4 py-4 flex flex-col gap-3">
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2">
            <span class="inline-flex h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(52,211,153,0.9)]"></span>
            <span class="text-xs font-medium text-slate-200">Live Decoder</span>
          </div>
          <div class="flex items-center gap-2 text-[11px] text-slate-400">
            <span id="modeLabel">Mode: On-device rules</span>
          </div>
        </div>

        <div class="flex gap-1 rounded-full bg-slate-900/80 p-1 text-xs">
          <button id="tab-audio" class="flex-1 rounded-full px-3 py-1.5 text-center font-medium bg-slate-800 text-sky-200">
            Audio
          </button>
          <button id="tab-text" class="flex-1 rounded-full px-3 py-1.5 text-center font-medium text-slate-300">
            Text
          </button>
          <button id="tab-image" class="flex-1 rounded-full px-3 py-1.5 text-center font-medium text-slate-300">
            Prescription
          </button>
        </div>

        <div id="panel-audio" class="space-y-2">
          <div class="text-[11px] text-slate-400">
            Tap record while the doctor explains, then stop. We’ll transcribe and decode key points.
          </div>
          <div class="flex items-center gap-3">
            <button id="recordBtn" class="inline-flex items-center gap-2 rounded-full bg-red-500/90 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-lg">
              <span id="recordDot" class="h-2.5 w-2.5 rounded-full bg-slate-950"></span>
              <span id="recordLabel">Start recording</span>
            </button>
            <div id="audioStatus" class="text-[11px] text-slate-400">Ready to record (Chrome recommended).</div>
          </div>
          <textarea id="audioText" class="mt-2 h-28 w-full rounded-2xl border border-slate-800 bg-slate-900/80 px-3 py-2 text-xs text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500" placeholder="Transcript will appear here. You can also edit it if needed."></textarea>
          <div class="flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 text-[11px] text-slate-400">
              <input id="extraSimpleAudio" type="checkbox" class="h-3.5 w-3.5 rounded border-slate-700 bg-slate-900" />
              <span>Extra simple language</span>
            </div>
            <button id="explainAudio" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-400 to-emerald-400 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-md">
              Explain this for the patient
            </button>
          </div>
        </div>

        <div id="panel-text" class="hidden space-y-2">
          <div class="text-[11px] text-slate-400">
            Paste any clinic note, discharge summary line, or prescription text here.
          </div>
          <textarea id="plainText" class="mt-1 h-32 w-full rounded-2xl border border-slate-800 bg-slate-900/80 px-3 py-2 text-xs text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500" placeholder="Example: Patient presents with acute exacerbation of chronic bronchitis. Start oral antibiotics, advise hydration, and schedule follow-up in 3 days."></textarea>
          <div class="flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 text-[11px] text-slate-400">
              <input id="extraSimpleText" type="checkbox" class="h-3.5 w-3.5 rounded border-slate-700 bg-slate-900" />
              <span>Extra simple language</span>
            </div>
            <div class="flex items-center gap-2">
              <button id="fillExample" class="rounded-full border border-slate-700 bg-slate-900/80 px-3 py-1.5 text-[11px] text-slate-300">
                Use example text
              </button>
              <button id="explainText" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-400 to-emerald-400 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-md">
                Explain this for the patient
              </button>
            </div>
          </div>
        </div>

        <div id="panel-image" class="hidden space-y-2">
          <div class="text-[11px] text-slate-400">
            Upload a clear photo or scan of a typed prescription. Handwriting may be harder to read.
          </div>
          <div class="flex items-center gap-2">
            <input id="imageInput" type="file" accept="image/*" class="block w-full text-[11px] text-slate-300 file:mr-3 file:rounded-full file:border-0 file:bg-sky-500/90 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-slate-950 hover:file:bg-sky-400" />
          </div>
          <div id="ocrStatus" class="text-[11px] text-slate-400">No image processed yet.</div>
          <textarea id="ocrText" class="mt-1 h-28 w-full rounded-2xl border border-slate-800 bg-slate-900/80 px-3 py-2 text-xs text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500" placeholder="Recognised prescription text will appear here."></textarea>
          <div class="flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 text-[11px] text-slate-400">
              <input id="extraSimpleImage" type="checkbox" class="h-3.5 w-3.5 rounded border-slate-700 bg-slate-900" />
              <span>Extra simple language</span>
            </div>
            <button id="explainImage" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-400 to-emerald-400 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-md">
              Explain this for the patient
            </button>
          </div>
        </div>

        <div class="mt-3 rounded-2xl border border-slate-800 bg-slate-900/90 px-3 py-3 flex flex-col gap-2 max-h-64 overflow-y-auto">
          <div class="flex items-center justify-between gap-2">
            <div class="flex items-center gap-2">
              <span class="h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.9)]"></span>
              <span class="text-xs font-medium text-slate-100">Plain-language summary for the patient</span>
            </div>
            <div class="text-[11px] text-slate-400" id="summaryStatus">Waiting for input…</div>
          </div>
          <ul id="summaryList" class="list-disc space-y-1 pl-4 text-[12px] text-slate-100">
            <li class="text-slate-400">When you decode something, key points will appear here as simple bullet points.</li>
          </ul>
          <p class="text-[11px] text-slate-400">
            Use this summary to remember the plan, but always confirm doubts directly with your doctor.
          </p>
        </div>
      </section>
    </main>

    <footer class="flex flex-col gap-2 text-[11px] text-slate-400 md:flex-row md:items-center md:justify-between">
      <p>ClinicBridge is an experimental patient-understanding interface. It does not replace a consultation with a qualified health professional.</p>
      <p>Host this file directly on <a href="https://pages.github.com" class="text-sky-300 hover:underline" target="_blank" rel="noreferrer">GitHub Pages</a> and extend it with your own AI backend.</p>
    </footer>
  </div>

  <script>
    const tabs = {
      audio: document.getElementById("tab-audio"),
      text: document.getElementById("tab-text"),
      image: document.getElementById("tab-image")
    };
    const panels = {
      audio: document.getElementById("panel-audio"),
      text: document.getElementById("panel-text"),
      image: document.getElementById("panel-image")
    };
    function activateTab(key) {
      Object.keys(tabs).forEach(k => {
        if (k === key) {
          tabs[k].classList.add("bg-slate-800","text-sky-200");
          panels[k].classList.remove("hidden");
        } else {
          tabs[k].classList.remove("bg-slate-800","text-sky-200");
          panels[k].classList.add("hidden");
        }
      });
    }
    tabs.audio.onclick = () => activateTab("audio");
    tabs.text.onclick = () => activateTab("text");
    tabs.image.onclick = () => activateTab("image");

    const jargonMap = [
      ["acute","sudden or very recent"],
      ["chronic","long-term or ongoing"],
      ["exacerbation","worsening or flare-up"],
      ["hypertension","high blood pressure"],
      ["hypotension","low blood pressure"],
      ["tachycardia","fast heartbeat"],
      ["bradycardia","slow heartbeat"],
      ["myocardial infarction","heart attack"],
      ["ischemia","not enough blood flow"],
      ["edema","swelling caused by extra fluid"],
      ["lesion","abnormal patch or spot on the body"],
      ["benign","not cancer and usually not dangerous"],
      ["malignant","cancerous and can spread"],
      ["prognosis","how the illness is likely to go in future"],
      ["diagnosis","name of the illness or condition"],
      ["respiratory distress","serious trouble breathing"],
      ["dehydration","not enough fluid in the body"],
      ["intravenous","through a vein using a drip or injection"],
      ["oral","by mouth"],
      ["topical","applied on the skin"],
      ["symptomatic relief","treatment that reduces discomfort but does not remove the cause"],
      ["monitor","keep watching carefully"],
      ["follow-up","come back again for review"],
      ["presented with","came to the doctor because of"],
      ["contraindicated","should not be used because it may be harmful"],
      ["adverse reaction","harmful or unwanted side effect"],
      ["labs","blood tests or other investigations"],
      ["vitals","basic body signs like pulse, blood pressure, temperature and breathing rate"],
      ["antibiotics","medicines used to treat bacterial infections"],
      ["infection","germs in the body causing illness"],
      ["inflammation","swelling, heat, or redness in part of the body"],
      ["idiopathic","cause is unknown"],
      ["metastasis","spread of cancer to other parts of the body"],
      ["remission","time when signs of disease reduce or disappear"],
      ["palliative","focused on comfort rather than cure"]
    ];
    const sentenceReplacements = [
      ["the patient","you"],
      ["patient","you"],
      ["pt","you"],
      ["presents with","came because of"],
      ["presented with","came because of"],
      ["advise","the doctor advises you to"],
      ["should be started on","you will start taking"],
      ["start","start taking"],
      ["will be monitored","we will keep watching"],
      ["needs to","you need to"],
      ["recommended","the doctor recommends"]
    ];
    function simplifyTerms(text, extraSimple) {
      let out = text;
      jargonMap.forEach(([term, plain]) => {
        const pattern = new RegExp("\\b" + term.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&") + "\\b","gi");
        out = out.replace(pattern, m => {
          const base = plain;
          if (extraSimple) return base;
          return base;
        });
      });
      sentenceReplacements.forEach(([from,to]) => {
        const pattern = new RegExp("\\b" + from.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&") + "\\b","gi");
        out = out.replace(pattern,to);
      });
      return out;
    }
    function splitSentences(text) {
      return text
        .replace(/\s+/g," ")
        .split(/(?<=[.!?])\s+/)
        .map(s => s.trim())
        .filter(Boolean);
    }
    function buildBulletSummary(rawText, extraSimple) {
      const base = simplifyTerms(rawText, extraSimple);
      const sentences = splitSentences(base);
      const cleaned = [];
      sentences.forEach(s => {
        let t = s;
        t = t.replace(/^you are advised to/i,"you should");
        t = t.replace(/^it is advised that/i,"you should");
        t = t.replace(/^plan:/i,"the plan is");
        t = t.replace(/^impression:/i,"the doctor thinks");
        t = t.replace(/^assessment:/i,"the doctor believes");
        if (extraSimple) {
          t = t.replace(/\badminister\b/gi,"give");
          t = t.replace(/\bcommence\b/gi,"start");
          t = t.replace(/\bdiscontinue\b/gi,"stop");
          t = t.replace(/\bconsume\b/gi,"take");
          t = t.replace(/\bprior to\b/gi,"before");
        }
        cleaned.push(t);
      });
      const bullets = [];
      cleaned.forEach(s => {
        if (/diagnosis|doctor thinks|doctor believes/i.test(s)) {
          bullets.push("What the doctor thinks is happening: " + s);
        } else if (/plan|start|continue|stop|take|give|dose|every|daily|twice/i.test(s)) {
          bullets.push("What you need to do with medicines or treatment: " + s);
        } else if (/follow-up|come back|review|next visit|in \d+ days/i.test(s)) {
          bullets.push("When you need to come back or follow up: " + s);
        } else if (/warning|if you/i.test(s) || /seek|immediately/i.test(s)) {
          bullets.push("Danger signs or when to seek help: " + s);
        } else {
          bullets.push(s);
        }
      });
      if (!bullets.length) return ["No clear sentences detected. Try adding a bit more context from the doctor's explanation."];
      const limited = bullets.slice(0,6);
      if (extraSimple && limited.length) {
        return limited.map(b => {
          let t = b;
          t = t.replace(/what the doctor thinks is happening:/i,"the doctor thinks this is happening:");
          t = t.replace(/what you need to do with medicines or treatment:/i,"about your medicines:");
          t = t.replace(/when you need to come back or follow up:/i,"about your next visit:");
          t = t.replace(/danger signs or when to seek help:/i,"watch out for this:");
          return t;
        });
      }
      return limited;
    }
    const summaryList = document.getElementById("summaryList");
    const summaryStatus = document.getElementById("summaryStatus");
    function renderSummary(bullets, label) {
      summaryList.innerHTML = "";
      bullets.forEach(b => {
        const li = document.createElement("li");
        li.className = "text-[12px] text-slate-100";
        li.textContent = b;
        summaryList.appendChild(li);
      });
      summaryStatus.textContent = label;
    }

    function handleExplain(text, extraSimple) {
      const t = text.trim();
      if (!t) {
        renderSummary(["Paste or record something first. For example, one or two lines from what the doctor said."],"No input");
        return;
      }
      summaryStatus.textContent = "Decoding…";
      const bullets = buildBulletSummary(t, extraSimple);
      renderSummary(bullets, extraSimple ? "Extra simple explanation" : "Standard simple explanation");
    }

    const plainText = document.getElementById("plainText");
    const fillExample = document.getElementById("fillExample");
    const explainText = document.getElementById("explainText");
    const extraSimpleText = document.getElementById("extraSimpleText");
    fillExample.onclick = () => {
      plainText.value = "Patient presented with acute exacerbation of chronic bronchitis. Start oral antibiotics and provide symptomatic relief. Advise adequate hydration, monitor vitals, and schedule follow-up in 3 days to review labs and check for any adverse reaction.";
      plainText.focus();
    };
    explainText.onclick = () => {
      handleExplain(plainText.value, extraSimpleText.checked);
    };

    const recordBtn = document.getElementById("recordBtn");
    const recordDot = document.getElementById("recordDot");
    const recordLabel = document.getElementById("recordLabel");
    const audioStatus = document.getElementById("audioStatus");
    const audioText = document.getElementById("audioText");
    const explainAudio = document.getElementById("explainAudio");
    const extraSimpleAudio = document.getElementById("extraSimpleAudio");
    let recognition = null;
    let isRecording = false;
    if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SR();
      recognition.lang = "en-IN";
      recognition.interimResults = true;
      recognition.continuous = true;
      recognition.onstart = () => {
        audioStatus.textContent = "Listening… ask the doctor to explain in simple sentences.";
      };
      recognition.onerror = e => {
        audioStatus.textContent = "Speech recognition error: " + e.error;
        isRecording = false;
        recordDot.classList.remove("bg-emerald-400");
        recordDot.classList.add("bg-slate-950");
        recordBtn.classList.remove("bg-red-400");
        recordBtn.classList.add("bg-red-500/90");
        recordLabel.textContent = "Start recording";
      };
      recognition.onresult = e => {
        let transcript = "";
        for (let i = 0; i < e.results.length; i++) {
          transcript += e.results[i][0].transcript + " ";
        }
        audioText.value = transcript.trim();
      };
      recognition.onend = () => {
        if (isRecording) {
          audioStatus.textContent = "Stopped listening.";
          isRecording = false;
          recordDot.classList.remove("bg-emerald-400");
          recordDot.classList.add("bg-slate-950");
          recordBtn.classList.remove("bg-red-400");
          recordBtn.classList.add("bg-red-500/90");
          recordLabel.textContent = "Start recording";
        }
      };
    } else {
      audioStatus.textContent = "Speech recognition not supported in this browser. Use Chrome on desktop or Android.";
      recordBtn.disabled = true;
      recordBtn.classList.add("opacity-60","cursor-not-allowed");
    }
    recordBtn.onclick = () => {
      if (!recognition) return;
      if (!isRecording) {
        recognition.start();
        isRecording = true;
        recordDot.classList.remove("bg-slate-950");
        recordDot.classList.add("bg-emerald-400");
        recordBtn.classList.remove("bg-red-500/90");
        recordBtn.classList.add("bg-red-400");
        recordLabel.textContent = "Stop recording";
        audioStatus.textContent = "Listening…";
      } else {
        recognition.stop();
        isRecording = false;
        recordDot.classList.remove("bg-emerald-400");
        recordDot.classList.add("bg-slate-950");
        recordBtn.classList.remove("bg-red-400");
        recordBtn.classList.add("bg-red-500/90");
        recordLabel.textContent = "Start recording";
        audioStatus.textContent = "Stopped recording.";
      }
    };
    explainAudio.onclick = () => {
      handleExplain(audioText.value, extraSimpleAudio.checked);
    };

    const imageInput = document.getElementById("imageInput");
    const ocrStatus = document.getElementById("ocrStatus");
    const ocrText = document.getElementById("ocrText");
    const explainImage = document.getElementById("explainImage");
    const extraSimpleImage = document.getElementById("extraSimpleImage");
    imageInput.onchange = () => {
      const file = imageInput.files && imageInput.files[0];
      if (!file) return;
      ocrStatus.textContent = "Running OCR on this image…";
      Tesseract.recognize(file,"eng",{ logger:m => {
        if (m.status === "recognizing text" && m.progress) {
          const pct = Math.round(m.progress*100);
          ocrStatus.textContent = "Recognising text… " + pct + "%";
        }
      }}).then(({ data }) => {
        ocrText.value = (data && data.text ? data.text.trim() : "");
        ocrStatus.textContent = "Finished reading text. Edit if needed, then tap explain.";
      }).catch(err => {
        ocrStatus.textContent = "Could not read this image. Try a clearer photo or typed prescription.";
      });
    };
    explainImage.onclick = () => {
      handleExplain(ocrText.value, extraSimpleImage.checked);
    };
  </script>
</body>
</html>
